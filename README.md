# MASLAB Raspberry Pi Setup

This repository contain scripts to modify, generate, and deploy Raspberry Pi OS image for each MASLAB team SD card.

> [!IMPORTANT]
> Script is designed to run on a Raspberry Pi with ARM64. Other platform has not been adapted / tested.

## Usage
### Prerequisites
* A Raspberry Pi running the latest version of Raspberry Pi OS
* An SD card reader (preferably USB 3 for faster write)

### Deploy steps
1. Use the SD card reader to attach an SD card to the Pi
1. Clone and cd into this repo with:
    `git clone https://github.com/MASLAB/raspi-setup && cd ./raspi-setup`
1. Run `setup-team.sh` script with team name and password
    `./setup-team.sh <team_name> <team_password>`
1. Remove the SD card
1. Rinse and repeat for all team

<!-- ### Script descriptions
`setup-base.sh` script will download the latest Raspberry Pi OS image. Then it will perform these tasks on the image:
* Update software
* Install driver for [TP-Link Archer T2U Nano](https://www.tp-link.com/us/home-networking/usb-adapter/archer-t2u-nano/) USB to WiFi adapter
* Install XRDP for remote desktop
* Set up update scripts to update Raven firmware and [maslab-lib](https://github.com/MASLAB/maslab-lib)
* Set up PollMeMaybe
* Disable Raspberry Pi first boot wizard
* Set up Raspberry Pi hardware
    - Enable UART, SPI, I2C interfaces
    - Set up Raspberry Pi USB Power option
    - Set up GPIO pins for [Raven](https://github.com/MASLAB/raven)
* Update EEPROM to [power off on shutdown](https://www.jeffgeerling.com/blog/2023/reducing-raspberry-pi-5s-power-consumption-140x)
* Setup polkit rules to allow shutdown, refresh, and setting wifi in remote desktop

`setup-team.sh` script will:
* Add team-specific configurations generated by `utils/generate-config.sh` to the image
* Write the image to an SD card -->